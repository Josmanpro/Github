<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Manual - SENA</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }

        h2 {
            text-align: center;
            color: #008000;
        }

        form {
            background: white;
            padding: 20px;
            max-width: 500px;
            margin: auto;
            border-radius: 10px;
            box-shadow: 0 0 10px #bbb;
        }

        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }
        .input-group {
            margin-right: 22px;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        button {
            background: #008000;
            color: white;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
        }

        button:hover {
            background: #006600;
        }

        .success {
            background: #c8ffc8;
            padding: 10px;
            border: 1px solid #00a000;
            margin-top: 15px;
            text-align: center;
            border-radius: 6px;
            display: none;
        }
    </style>
</head>
<body>

    <h2>Registro de Portátiles - SENA</h2>

    <form id="registroForm">
        <div class="input-group">
            <label>Nombre completo:</label>
            <input type="text" id="nombre" required>
        </div>

        <label>Procedencia (Programa):</label>
            <select id="procedencia" required>
                <option value="">Seleccione...</option>
                <option value="ADSO">ADSO</option>
                <option value="Asistencia Administrativa">Asistencia Administrativa</option>
                <option value="Contabilidad">Contabilidad</option>
                <option value="Invitado">Invitado</option>
            </select>
        
        <div class="input-group">
            <label>Serial o referencia del portátil:</label>
            <input type="text" id="serial" required>
        </div>

        <div class="input-group">
            <label>Hora de entrada:</label>
            <input type="text" id="horaEntrada" readonly>
        </div>


        <button type="submit">Registrar Entrada</button>
    </form>

    <div class="success" id="mensajeExito">
        Registro guardado exitosamente ✔
    </div>

    <!-- Firebase -->
    <script type="module">
        // Import de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } 
               from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // CONFIG FIREBASE (TUS LLAVES)
        const firebaseConfig = { 
            apiKey: "AIzaSyDqSIFW_5x65yZNGyphr1Ld860DoHZQpxg",
            authDomain: "registro-portatiles-sena.firebaseapp.com",
            projectId: "registro-portatiles-sena",
            storageBucket: "registro-portatiles-sena.firebasestorage.app",
            messagingSenderId: "140602261232",
            appId: "1:140602261232:web:e0360347eb1e56273c8c35"
        };

        // Inicializar Firebase y DB
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Evento del formulario
        const form = document.getElementById("registroForm");
        const mensajeExito = document.getElementById("mensajeExito");

        function obtenerHoraFormato12() {
            const fecha = new Date();
            let horas = fecha.getHours();
            let minutos = fecha.getMinutes();
            const ampm = horas >= 12 ? "PM" : "AM";

            horas = horas % 12;
            horas = horas ? horas : 12; // 0 → 12

            minutos = minutos < 10 ? "0" + minutos : minutos;

            return `${horas}:${minutos} ${ampm}`;
        }
        

        // Mostrar la hora al cargar la página
        document.getElementById("horaEntrada").value = obtenerHoraFormato12();


        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const nombre = document.getElementById("nombre").value;
            const procedencia = document.getElementById("procedencia").value;
            const serial = document.getElementById("serial").value;

            try {
                await addDoc(collection(db, "registros"), {
                    nombre,
                    procedencia,
                    serial,
                    fecha: serverTimestamp(),
                    entrada: new Date(),
                    salida: "",
                    tipo: "manual"
                });

                mensajeExito.style.display = "block";
                form.reset();

                setTimeout(() => {
                    mensajeExito.style.display = "none";
                }, 2500);

            } catch (error) {
                alert("Error al guardar: " + error);
            }
        });
    </script>

</body>
</html>
